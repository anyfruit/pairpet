<view class="container">
  <view class="card">
    <view class="title">ä½ å¥½ï¼Œ{{user ? user.nickname : "å¾®ä¿¡ç”¨æˆ·"}}</view>
    <view class="subtitle">ä»Šæ—¥ï¼š{{dateKey}}</view>
    <view wx:if="{{loading}}">æ­£åœ¨åŠ è½½é¦–é¡µæ•°æ®...</view>
    <view wx:if="{{errorMessage}}" class="error-text">{{errorMessage}}</view>
  </view>

  <view wx:if="{{!loading && !hasBound}}" class="card">
    <view class="title">è¿˜æ²¡æœ‰ç»‘å®šæ­å­</view>
    <view class="subtitle">å®Œæˆç»‘å®šåå¯ä»¥å…±åŒå…»å® ã€å…±äº«ä»»åŠ¡è¿›åº¦ã€‚</view>
    <button type="primary" bindtap="goPair">å»ç»‘å®šé¡µ</button>
  </view>

  <view wx:if="{{!loading && hasBound && pet}}" class="card pet-card">
    <view class="title">ğŸ¾ {{pet.name}}</view>
    <view class="pet-line">å“ç§ï¼š{{pet.species || "dog"}} | ç­‰çº§ï¼šLv.{{pet.level}}</view>
    <view class="pet-line">é˜¶æ®µï¼š{{petStageText}} | å¿ƒæƒ…ï¼š{{petMoodText}}</view>
    <view class="pet-line">ç»éªŒï¼š{{expCurrentInLevel}} / {{expNeededInLevel}}</view>
    <view class="progress-track">
      <view class="progress-bar" style="width: {{petExpProgress}}%;"></view>
    </view>
  </view>

  <view wx:if="{{!loading && hasBound && pair}}" class="card">
    <view class="title">äº²å¯†å€¼æ€»åˆ†</view>
    <view class="score">{{pair.intimacyScore}}</view>
    <view wx:if="{{recentIntimacyChange}}" class="subtitle">
      æœ€è¿‘å˜åŠ¨ï¼š+{{recentIntimacyChange.points}}ï¼ˆ{{recentIntimacyChange.sourceType}}ï¼‰
    </view>
  </view>

  <view wx:if="{{!loading && hasBound}}" class="card">
    <view class="title">ä»Šæ—¥è¿›åº¦</view>
    <view>{{todaySummary.completed}} / {{todaySummary.total}} å·²å®Œæˆ</view>
    <view class="subtitle">å…±åŒä»»åŠ¡ï¼š{{todaySummary.sharedCompleted}} / {{todaySummary.sharedTotal}}</view>
  </view>

  <view wx:if="{{!loading && hasBound && todaySummary.sharedTasks.length > 0}}" class="card">
    <view class="title">ä»Šæ—¥å…±åŒä»»åŠ¡</view>
    <block wx:for="{{todaySummary.sharedTasks}}" wx:key="taskId">
      <view class="task-line">
        <view>{{item.title}}</view>
        <view class="task-status">æˆ‘ {{item.selfDone ? "âœ…" : "â¬œ"}} / TA {{item.partnerDone ? "âœ…" : "â¬œ"}}</view>
      </view>
    </block>
  </view>

  <view wx:if="{{!loading && hasBound && todaySummary.total === 0}}" class="card">
    <view class="title">ä»Šå¤©è¿˜æ²¡æœ‰ä»»åŠ¡</view>
    <view class="subtitle">å…ˆåˆ›å»ºä¸€ä¸ªä»»åŠ¡å¼€å¯å…»å® å¾ªç¯å§ã€‚</view>
    <button type="primary" bindtap="goTaskCreate">å»æ–°å»ºä»»åŠ¡</button>
  </view>

  <view class="btn-row" wx:if="{{!loading && hasBound}}">
    <button size="mini" type="primary" bindtap="goTasks">å»ä»»åŠ¡é¡µ</button>
    <button size="mini" bindtap="goTaskCreate">æ–°å»ºä»»åŠ¡</button>
  </view>
</view>
